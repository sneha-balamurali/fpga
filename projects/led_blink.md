# LED Blink

## What this Section Covers:

Welcome to the first project!  
You can think of this as the "Hello World" of FPGA / Red Pitaya development.

It covers:

- **IP Cores in Vivado:**
  - What they are and why they simplify design
  - How to add and configure them in a block design
- **Clocks and Counters:**
  - Using the [125 MHz fabric clock, `FCLK_CLK0`,](/introduction/vivado_overview.md#fclk_clk0) generated by the Zynq Processing System.
  - How a binary counter works and why use its higher-order bits to slow down the LED blink to human-visible speed
- **The Slice IP:**
  - How to extract a single bit (bit 27) from the counter output
  - Why newer Vivado versions use inline HDL instead of utility Slice blocks
- **Connecting to hardware:**
  - Linking the processed signal to the `led_o` port.
  - Generating the bitstream and uploading it to the Red Pitaya

By the end of this section, you’ll understand how to use IP cores, work with clocks and counters, and build your first working FPGA project on the Red Pitaya.

## Background

- In this tutorial, we won’t be writing any new HDL code ourselves. Instead, we’ll use IP cores — pre-built modules that Vivado provides.

### What are IP cores?

- In FPGA development, IP (Intellectual Property) cores are predesigned, reusable hardware blocks.[^1] Examples include counters, memory controllers, ADC/DAC interfaces, and more.

#### Why use IP cores?

- You don’t have to reinvent everything — the modules are already designed, tested, and optimised.  
- They simplify design by abstracting away lower-level complexity. 
    - For example: if you want to divide a 125 MHz clock down to 1 Hz so an LED blinks once per second, you could write a counter in Verilog/VHDL by hand. Instead, Vivado provides a ready-made Binary Counter IP core. You just drop it into your block design, set its output width (e.g. 28 bits), and it gives you the divided clock signal automatically which we will see below in more detail.
- They are configurable (e.g. width, depth, mode), so you can adapt them to your project.
- If you click on the IP catalog in the flow navigator, you can search the different IP cores available. You will notice there are two repositories: User Repository and Vivado Repository. If you expand BaseIP you will see all the cores from your cores folder. 
![IP Catalog](/images/led_blink/ip_catalog.png)

### IP Integrator

- On the left of the Vivado window (under the Flow Navigator), you’ll see IP INTEGRATOR. If you expand it, you’ll find the options:
  - Create Block Design
  - Open Block Design
  - Generate Block Design.
- IP Integrator is a tool that lets you visually assemble systems by dragging in IP cores, wiring them together, and configuring them. This means you don’t have to hand-code every connection in HDL — you can work graphically and parametrically.[^1]

### Clocks

- In order for our LED to blink periodically, it needs a clock as a reference to let it know when to blink. 
- In digital logic, a clock is a repeating signal that oscillates between high (1) and low (0). It acts as a timing reference so that all parts of the circuit know exactly when to update or transfer data.

![square_wave](/images/vivado_overview/square_wave.jpg)
- Here we have a periodic square wave. In digital logic, we can get our LED to blink on and off every time there is a rising edge (when it goes from 0 to 1) or falling edge (when it goes from 1 to 0). This is how the different parts of the circuit keep track of time and know when to update or transfer data. 
- Now we realise that we need a clock for our LED.
- In this tutorial we will be using the [125 MHz fabric clock generated by the Zynq Processing System, `FCLK_CLK0`](/introduction/vivado_overview.md#fclk_clk0). However, it is 125 MHz, which would mean that the LED would blink every 8ns...far too fast for our eyes to notice. The LED would just look like its on and not flashing on and off. 
- In order to deal with that, we will use a binary counter.

### Binary Counter

- A binary counter is a simple digital circuit that increments or decrements a binary number on each clock "tick" (rising or falling edge).
- It is given as an IP core in Vivado - the AMD Binary Counter v12.0 is the one we use in our tutorial.[^2]

#### Example:

- Suppose you have a 4-bit counter. It starts at `0000`. Then on each clock edge, it increments: `0001`, `0010`, `0011`, etc., up to `1111`. Then it wraps around to `0000` again. This is shown below.

**4-bit Counter Table:**

|Count|Bit 3|Bit 2|Bit 1|Bit 0|
|-----|-----|-----|------|-----|
|0|0|0|0|0|
|1|0|0|0|1|
|2|0|0|1|0|
|3|0|0|1|1|
|4|0|1|0|0|
|5|0|1|0|1|
|6|0|1|1|0|
|7|0|1|1|1|
|8|1|0|0|0|
|9|1|0|0|1|
|10|1|0|1|0|
|11|1|0|1|1|
|12|1|1|0|0|
|13|1|1|0|1|
|14|1|1|1|0|
|15|1|1|1|1|

#### Notice:

- Bit 0 (LSB) toggles every clock tick.
- Bit 1 toggles every 2 ticks.
- Bit 2 toggles every 4 ticks.
- Bit 3 (MSB) toggles every 8 ticks.

- LSB = Least Significant Bit
- MSB = Most Significant Bit

This shows that higher-order bits have half the frequency of the bit below. In general:

$f_\text{bit n} = \frac{f_{clock}}{2^n}$

#### Why is this useful?

- If your input clock is too fast (e.g. 125 MHz on the Red Pitaya), you can use a higher order bit of a binary counter as a slower clock signal.
- This way, you don't need to manually divide the clock - the counter does it for free.

#### Back to our LED blink:

- [`FCLK_CLK0`](/introduction/vivado_overview.md#fclk_clk0) runs at 125 MHz, so each count happens every 8ns.
- If we use bit 27 of a 28-bit counter, it toggles roughly once per second:

$$
  \frac{2^{27}}{125 \times 10^6 \,\text{s}^{-1}} \approx 1.07 \,\text{s}
$$  

$$
\frac{2^{27}}{125 \times 10^6 \text{s}^{-1}} \approx 1.07 \text{s}
$$

This is now slow enough for our eyes to see the LED blink on and off.

### Slice

- The Binary Counter IP outputs all the bits at once i.e. 28 bits wide. So we get something like:

```arduino
[bit 27, bit 26, bit 25, ..., bit 0]
```

- But for the LED blink, we only care about bit 27 because that's the one that toggles about once per second. 
- Our LED output (`led_o[0:0]`) also expects 1 bit. If you tried to connect a 28 bit output to a 1 bit output, Vivado would complain.

#### Solution?

- The Slice IP lets you cut out a subset of bits from a larger bus.[^3]
- You tell it: input width = 28, Din from = 27, Din to = 27.
- This means "out of the 28 bits, only keep bit 27."
- The Slice then outputs a 1-bit signal that you can neatly connect to the LED port.
- In this tutorial we only need a single Slice block, but in general you can add multiple Slices if you want to break out different ranges of bits from the same bus.

## Tutorial

With this setup, the chosen LED will now blink roughly once per second.

1. Open up your Vivado project described in the [Setup Guide](/introduction/setup_guide.md#opening-a-new-project)
2. Open up your Block Design. 
3. Right-click in the blank workspace and select Add IP.

![add_ip](/images/led_blink/add_IP.png)

## Step 1: Add a Binary Counter

- Insert the Binary Counter IP into the design.
- Double-click the block to open its configuration menu.
- Change the Output Width to 28.

![output_width_to_28](/images/led_blink/change_output_width_of_binary_counter.png)

## Step 2: Add a Slice

- Add the Inline Slice IP if you're using new Vivado versions or the Slice IP if you are using older Vivado versions.
- In my screenshots you’ll see the Slice IP (Vivado labels it as “Slice (Discontinued)” in Vivado 2025.1). I used it because it still appears in older tutorials and is useful to explain what’s happening. The newer Inline Slice works identically for this tutorial so don't worry.
- In newer Vivado versions, AMD provides inline HDL IPs (e.g. inline_slice) as replacements for older utility IPs like xlslice. These inline versions are lighter, faster to generate, and scale better in large projects. AMD now recommends using inline HDL IPs instead.[^1] [More info at UG994: Inline HDL](https://docs.amd.com/r/en-US/ug994-vivado-ip-subsystems/Inline-HDL)
- Double-click and set the properties as shown below:

![slice properties](/images/led_blink/slice_properties.png)

## Step 3: Connect to the LED port

- In the block design, locate the port labelled `led_o[7:0]`
-Right-click it and choose External Port Properties.
- At the bottom, there will be two tabs: "General" and "Properties." Click on the Properties tab. 
- Change the LEFT attribute from `7` to `0`, so only a single LED line (`led_o[0:0]`) is exposed.

![led port properties](/images/led_blink/led_port_properties.png)

## Step 4: Wire the Blocks Together

- Hover over a port (e.g. the `CLK` pin of the Binary Counter). A pen icon will appear.
- Click and drag it to connect it to `FCLK_CLK0` in the ZYNQ7 Processing System. Press `esc` to get back to the normal selection mouse.
- Connect the rest as shown in the block design below.
- To disconnect something, right-click the port and select Disconnect Pin. Vivado calls them pins in the block diagram, but these correspond to the input/output ports of the IP core.

![led blink block design](/images/led_blink/led_blink_bd.png)

## Step 5: Generate the Bitstream

- In the Flow Navigator on the left, click Generate Bitstream.
- A pop-up will ask to save the block design, choose Save to continue.
- Then the below will open up asking to run implementation and synthesis. Click yes. 
![implementation and synthesis request](/images/led_blink/implementation_synthesis_run_request.png)
- You will then get a pop up called Launch Runs, as shown below. Click ok and wait for the bitstream to generate. 

![launch runs](/images/led_blink/launch_runs.png)

## Step 6: Upload to Red Pitaya

[Connect to your Red Pitaya](/introduction/setup_guide.md/#connecting-to-your-red-pitaya)

## Learner's tip

- Try changing the Slice to use bit 26 or 25 and see how the blink speed changes.

## References:

[^1]: AMD. *Vivado Design Suite User Guide: Designing IP Subsystems Using IP Integrator (UG994)*. Available at: https://docs.amd.com/r/en-US/ug994-vivado-ip-subsystems/Getting-Started-with-Vivado-IP-Integrator

[^2]: AMD. *Binary Counter v12.0 Product Guide (PG121)*. Available at: https://docs.amd.com/v/u/en-US/pg121-c-counter-binary

[^3]: AMD. *Slice v1.0 Product Brief (PB042)*. Available at: https://docs.amd.com/v/u/en-US/pb042-xilinx-com-ip-xlslice 